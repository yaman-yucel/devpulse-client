requests:
{
  "username": "alice",
  "hostname": "WS-123",
  "platform": "linux",
  "enrollment_secret": "ORG_BOOTSTRAP_TOKEN_1"
}

enrollment_secret given by admin

response
{
  "user_id": "alice",             // canonical
  "device_id": "dev_a12b34c",
  "api_key": "xyz-or-jwt-refresh",
  "config": {
    "batch": {"max_events": 100, "max_interval_ms": 1000},
    "heartbeat_interval_s": 5
  }
}

need a user table at server
status of user: 
    active suspended disabled

devices table:
    device_id
    current_user_id
    hostname
    platform
    enrolled_at
    revoked_at null unless disabled
    notes
device_user_history table:
    device_id FK
    user_id FK
    assign_date
    revoke_date   
    log_id PK

store credentials.json ~/.devpulse/credentials.json  (chmod 600)
{
  "device_id": "dev_a12b34c",
  "user_id": "alice",
  "api_key": "....",
  "issued_at": "2025-07-17T07:25:00Z",
  "expires_at": null    // or timestamp if JWT
}


devpulse-agent enroll \
  --username "$(whoami)" \
  --server https://devpulse.internal \
  --enrollment-secret "$(cat /etc/devpulse/enroll_token)"


CREATE TABLE users (
  user_id TEXT PRIMARY KEY,      -- canonical username/email
  display_name TEXT,
  status TEXT NOT NULL DEFAULT 'active',  -- active|suspended|disabled
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);

CREATE TABLE devices (
  device_id TEXT PRIMARY KEY,
  user_id TEXT REFERENCES users(user_id),
  hostname TEXT NOT NULL,
  platform TEXT,
  enrolled_at timestamptz DEFAULT now(),
  revoked_at timestamptz,
  last_seen_at timestamptz
);

CREATE TABLE device_user_history (
  id bigserial PRIMARY KEY,
  device_id TEXT REFERENCES devices(device_id),
  user_id TEXT REFERENCES users(user_id),
  started_at timestamptz NOT NULL,
  ended_at timestamptz
);

13. Deciding When to Add a UI / Admin API

You need an admin way to:

    Add / disable users

    View enrolled devices

    Reissue keys

Simplest: psql console + SQL scripts.
Next: small admin REST endpoints + basic auth.
Later: full web UI w/ RBAC.